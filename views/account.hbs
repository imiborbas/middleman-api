<!DOCTYPE html>
<html>
  <head>
    {{> head}}
  </head>
  <body>
    {{> header}}

    <div class="centered-form">
      <h3>Account Settings</h3>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>

    // auth function that redirects user to login if not authed and otherwise returns dev info
    async function auth() {
      //  if no cookie, redirect to Login
      if (document.cookie === '') { window.location = '/login'; }

      // otherwise get id
      let developerId = await fetch('/developers/me', {
        headers: {
          'x-auth-key': document.cookie
        }
      }).catch((e) => {
        // error authenticating, redirect the user to login
        console.log(e);
        window.location = '/login';
      })
        return developerId.json()
    }

    //main
    void async function() {
      //first auth the user. devId is at account._id, email is at account.email
      let {account} = await auth();

      // display the user's email in the top corner
      jQuery('#banner').append(`<p id="my-email"><a href="/account">${account.email}</a></p>`);

      // display email and authkey on the page
      jQuery('.centered-form').append(`<h4>✉️ Your Email:</h4><span class="preformatted" style="background-color: white;">${account.email}</span><h4>🔑 Your API Token:</h4><span class="preformatted" style="background-color: white; overflow-wrap: break-word;">${document.cookie}</span>`);


    }()

    // display account details
    </script>
  </body>
</html>
